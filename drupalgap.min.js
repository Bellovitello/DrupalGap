/*! drupalgap 2015-12-18 */
function theme_actions(a){var b="";for(prop in a)dg.isFormElement(prop,a)&&(b+=dg.render(a[prop]));return b}function theme_password(a){return a._attributes.type="password","<input "+dg.attributes(a._attributes)+" />"}function theme_submit(a){a._attributes.type="submit";var b="Submit";return a._attributes.value||"undefined"!=typeof a._value&&(b=a._value),a._attributes.value=b,"<input "+dg.attributes(a._attributes)+"/>"}function theme_textfield(a){return a._attributes.type="text","<input "+dg.attributes(a._attributes)+"/>"}var dg={},drupalgap=dg;dg.settings={mode:"web-app",front:null},dg.config=function(a){var b=arguments[1]?arguments[1]:null;return b?void(dg.settings[a]=b):dg.settings[a]},dg.getMode=function(){return this.config("mode")},dg.setMode=function(a){this.config("mode",a)},dg.start=function(){"phonegap"==dg.getMode()?document.addEventListener("deviceready",dg.deviceready,!1):dg.deviceready()},dg.deviceready=function(){return dg.bootstrap(),jDrupal.isReady()?void jDrupal.connect().then(this.devicereadyGood,this.devicereadyBad):void dg.alert("Set the sitePath in the settings.js file!")},dg.devicereadyGood=function(){dg.router.check(dg.router.getFragment())},dg.devicereadyBad=function(){var a="Failed connection to "+jDrupal.sitePath();""!=msg&&(a+=" - "+msg),dg.alert(a,{title:"Unable to Connect",alertCallback:function(){}})},dg.bootstrap=function(){jDrupal.modules.dgUser={},this.router.config({});var a=jDrupal.modulesLoad();for(var b in a)if(a.hasOwnProperty(b)&&window[b].routing){var c=window[b].routing();if(c)for(route in c)if(c.hasOwnProperty(route)){var d=c[route];this.router.add(d)}}this.router.add(function(){}).listen()},dg.getCamelCase=function(a){return a.replace(/[-_]([a-z])/g,function(a){return a[1].toUpperCase()})},dg.killCamelCase=function(a,b){return jDrupal.lcfirst(a).replace(/([A-Z])/g,b+"$1").toLowerCase()},dg.forms={},dg.addForm=function(a,b){return this.forms[a]=b,this.forms[a]},dg.loadForm=function(a){return this.forms[a]?this.forms[a]:null},dg.loadForms=function(){return this.forms},dg.removeForm=function(a){delete this.forms[a]},dg.removeForms=function(){this.forms={}},dg.Form=function(a){this.id=a,this.form={_attributes:{id:dg.killCamelCase(a,"-").toLowerCase()}},this.form_state={}},dg.Form.prototype.getFormId=function(){return this.id},dg.Form.prototype.getForm=function(){var a=this;return new Promise(function(b,c){a.buildForm(a.form,a.form_state).then(function(){for(var c in a.form)if(dg.isFormElement(c,a.form)){var d=a.form[c]._attributes?a.form[c]._attributes:{};d.id||(d.id="edit-"+c),d.name||(d.name=c),a.form[c]._attributes=d}var e="<form "+dg.attributes(a.form._attributes)+">"+dg.render(a.form)+"</form>";b(e)})})},dg.Form.prototype.getFormState=function(){return this.form_state},dg.Form.prototype.buildForm=function(a,b,c){return new Promise(function(a,b){a()})},dg.Form.prototype.validateForm=function(a){return new Promise(function(a,b){a()})},dg.Form.prototype.submitForm=function(a,b,c){return new Promise(function(a,b){a()})},dg.Form.prototype._submit=function(){var a=this;return new Promise(function(b,c){a.formStateAssemble().then(function(){a.validateForm().then(function(){a.submitForm().then(function(){a.form._action&&dg["goto"](a._action),dg.removeForm(a.getFormId()),b()})})})})},dg.Form.prototype.formStateAssemble=function(a){var b=this;return b.form_state={values:{}},new Promise(function(a,c){for(var d in b.form)if(dg.isFormElement(d,b.form)){var e=b.form[d],f=document.getElementById(e._attributes.id);f&&(b.form_state.values[d]=f.value)}a()})},dg.isFormElement=function(a,b){return b.hasOwnProperty(a)&&"_"!=a.charAt(0)},dg.isFormProperty=function(a,b){return b.hasOwnProperty(a)&&"_"==a.charAt(0)},dg["goto"]=function(a){this.router.navigate(a)},dg.alert=function(a){var b=null;arguments[1]&&(b=arguments[1]);var c=function(){},d="Alert",e="OK";b&&(b.alertCallback&&(c=b.alertCallback),b.title&&(d=b.title),b.buttonName&&(e=b.buttonName)),"phonegap"!=dg.config("mode")||"undefined"==typeof navigator.notification?(alert(a),c()):navigator.notification.alert(a,c,d,e)},dg.Module=function(){},dg.Module.prototype=new jDrupal.Module,dg.Module.prototype.constructor=dg.Module,dg.Module.prototype.routing=function(){return null},dg.appRender=function(a){document.getElementById("dg-app").innerHTML=dg.render(a)},dg.render=function(a){try{var b=typeof a;if("string"===b)return a;var c="";if("object"===b){var d=a._prefix?a._prefix:"",e=a._suffix?a._suffix:"";if(a._markup)return d+a._markup+e;if(a._theme)return d+dg.theme(a._theme,a)+e;if(a._type)return d+dg.theme(a._type,a)+e;c+=d;for(var f in a)if(a.hasOwnProperty(f)&&"_prefix"!=f&&"_suffix"!=f){var g=a[f],h=typeof g;if("object"===h)c+=dg.render(g);else if("array"===h)for(var i=0;i<g.length;i++)c+=dg.render(g[i])}c+=e}else if("array"===b)for(var i=0;i<a.length;i++)c+=dg.render(a[i]);return c}catch(j){console.log("dg.render - "+j)}},dg.router={routes:[],mode:null,root:"/",config:function(a){return this.mode=a&&a.mode&&"history"==a.mode&&history.pushState?"history":"hash",this.root=a&&a.root?"/"+this.clearSlashes(a.root)+"/":"/",this},getFragment:function(){var a="";if("history"===this.mode)a=this.clearSlashes(decodeURI(location.pathname+location.search)),a=a.replace(/\?(.*)$/,""),a="/"!=this.root?a.replace(this.root,""):a;else{var b=window.location.href.match(/#(.*)$/);a=b?b[1]:""}return this.clearSlashes(a)},prepFragment:function(a){var b=a||this.getFragment();return this.root+b},clearSlashes:function(a){return a.toString().replace(/\/$/,"").replace(/^\//,"")},add:function(a){return this.routes.push(a),this},remove:function(a){for(var b,c=0;c<this.routes.length,b=this.routes[c];c++)if(b.path.toString()===a.toString())return this.routes.splice(c,1),this;return this},flush:function(){return this.routes=[],this.mode=null,this.root="/",this},check:function(a){var b=this.load(a);if(b&&(dg.removeForms(),b.defaults||(b=this.load(dg.config("front"))),b.defaults))if(b.defaults._form){var c=b.defaults._form;dg.addForm(c,new window[c]).getForm().then(function(a){function b(a){a.preventDefault&&a.preventDefault();var b=dg.loadForm(d);return b._submit().then(function(){},function(){}),!1}dg.appRender(a);var c=dg.loadForms();for(var d in c)if(c.hasOwnProperty(d)){var e=document.getElementById(dg.killCamelCase(d,"-"));e.attachEvent?e.attachEvent("submit",b):e.addEventListener("submit",b)}})}else b.defaults._controller().then(function(a){dg.appRender(a)});return this},listen:function(){var a=this,b=a.getFragment(),c=function(){b!==a.getFragment()&&(b=a.getFragment(),a.check(b))};return clearInterval(this.interval),this.interval=setInterval(c,50),this},load:function(a){for(var b=this.prepFragment(a),c=0;c<this.routes.length;c++){var d=b.match(this.routes[c].path);if(d)return this.routes[c]}return null},navigate:function(a){if(a=a?a:"","history"===this.mode){var b=this.root+this.clearSlashes(a);history.pushState(null,null,b)}else window.location.href=window.location.href.replace(/#(.*)$/,"")+"#"+a;return this},getRoutes:function(){return this.routes},getRoute:function(){}},dg.attributes=function(a){var b="";if(a)for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];""!=d?b+=c+'="'+d+'" ':"class"!=c&&(b+=c+" ")}return b},dg.theme=function(a,b){try{if(b||(b={}),b._markup)return b._markup;var c="",d="theme_"+a;if(!jDrupal.functionExists(d)){var e=null;arguments.callee.caller&&(e=arguments.callee.caller.name);var f="WARNING: "+d+"() does not exist.";return e&&(f+=" Called by: "+e+"()."),console.log(f),c}return b._attributes||(b._attributes={}),b._attributes["class"]||(b._attributes["class"]=[]),window[d].call(null,b)}catch(g){console.log("dg.theme - "+g)}},dg.currentUser=function(){return jDrupal.currentUser()};var UserLoginForm=function(){this.buildForm=function(a,b,c){return new Promise(function(b,c){a._action=dg.config("front"),a.name={_type:"textfield",_title:"Username",_required:!0,_title_placeholder:!0},a.pass={_type:"password",_title:"Password",_required:!0,_title_placeholder:!0},a.actions={_type:"actions",submit:{_type:"submit",_value:"Log in",_button_type:"primary"}},b(a)})},this.submitForm=function(){var a=this;return new Promise(function(b,c){var d=a.getFormState();jDrupal.userLogin(d.values.name,d.values.pass).then(b)})}};UserLoginForm.prototype=new dg.Form("UserLoginForm"),UserLoginForm.constructor=UserLoginForm;var dgUser=new dg.Module;dgUser.routing=function(){var a={};return a["user.login"]={path:"/user/login",defaults:{_form:"UserLoginForm",_title:"Log in"},requirements:{_user_is_logged_in:!0}},a};